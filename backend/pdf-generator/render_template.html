<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Inspection Report - {{inspectionId}}</title>
  <style>
    /* Page setup for A4 printing */
    @page { size: A4; margin: 18mm; }
    html, body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color: #222;
      font-size: 12px;
      line-height: 1.35;
      margin: 0;
      padding: 0;
    }

    .sheet {
      width: 210mm;
      min-height: 297mm;
      padding: 12mm;
      box-sizing: border-box;
      background: white;
    }

    /* Header */
    header {
      display:flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      border-bottom: 1px solid #e6e6e6;
      padding-bottom: 8px;
    }
    .logo img {
      width: 150px;
      height: 48px;
      object-fit: contain;
      display:block;
    }
    .report-meta {
      text-align: right;
      font-size: 11px;
      color: #555;
    }
    .title {
      font-size: 18px;
      font-weight: 700;
      margin-top: 8px;
      margin-bottom: 4px;
    }

    /* Intro */
    .vehicle-info {
      display:flex;
      gap: 12px;
      margin-top: 10px;
      margin-bottom: 12px;
    }
    .vehicle-block {
      flex: 1;
      padding: 8px;
      background: #fafafa;
      border: 1px solid #eee;
      border-radius: 6px;
    }
    .vehicle-block h4 { margin: 0 0 6px 0; font-size: 13px; }
    .vehicle-block p { margin: 2px 0; font-size: 12px; color: #333; }

    /* Summary */
    .summary {
      margin: 12px 0;
      padding: 10px;
      border-left: 4px solid #0073bb;
      background: #fbfdff;
    }
    .summary p { margin: 4px 0; color: #222; }

    /* Sections */
    section.inspection-section {
      margin: 14px 0;
      page-break-inside: avoid;
    }
    section.inspection-section h3 {
      font-size: 14px;
      margin: 6px 0 8px 0;
      color: #174e7b;
      border-bottom: 1px dashed #e6e6e6;
      padding-bottom: 6px;
    }
    .items { display:block; list-style:none; padding:0; margin:0; }
    .item { margin-bottom: 6px; display:flex; gap: 8px; align-items:flex-start; }
    .item .label { width:160px; color:#666; font-weight:600; }
    .item .value { flex:1; color:#222; }

    /* Image grid */
    .images-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
    }
    .images-grid .img-wrap {
      width: 140px;
      height: 100px;
      border: 1px solid #e6e6e6;
      background: #fff;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow: hidden;
      border-radius: 4px;
    }
    .images-grid img {
      max-width: 100%;
      max-height: 100%;
      object-fit: cover;
      display:block;
    }

    /* Footer */
    footer {
      position: absolute;
      bottom: 12mm;
      left: 12mm;
      right: 12mm;
      font-size: 10px;
      color: #777;
      border-top: 1px solid #eee;
      padding-top: 6px;
      display:flex;
      justify-content: space-between;
    }

    /* Helpers for mustache conditional rendering */
    .hidden { display:none; }
  </style>
</head>
<body>
  <div class="sheet">
    <header>
      <div class="logo">
        <!-- logoUrl is expected to be a full URL (S3 public or presigned); fallback to DEFAULT logo handled in handler -->
        <img src="{{logoUrl}}" alt="InspectionWale logo" />
      </div>
      <div class="report-meta">
        <div>Inspection ID: <strong>{{inspectionId}}</strong></div>
        <div>Date: <strong>{{inspectionDate}}</strong></div>
        <div>Inspector: <strong>{{inspectorName}}</strong></div>
      </div>
    </header>

    <main>
      <div class="title">Vehicle Inspection Report</div>

      <div class="vehicle-info">
        <div class="vehicle-block">
          <h4>Vehicle</h4>
          <p><strong>Registration:</strong> {{vehicle.regNumber}}</p>
          <p><strong>Make / Model:</strong> {{vehicle.makeModel}}</p>
          <p><strong>VIN:</strong> {{vehicle.vin}}</p>
          <p><strong>Odometer:</strong> {{vehicle.odometer}}</p>
        </div>

        <div class="vehicle-block">
          <h4>Customer</h4>
          <p><strong>Name:</strong> {{customer.name}}</p>
          <p><strong>Phone:</strong> {{customer.phone}}</p>
          <p><strong>Email:</strong> {{customer.email}}</p>
          <p><strong>Address:</strong> {{customer.address}}</p>
        </div>
      </div>

      <div class="summary">
        <strong>Summary</strong>
        <p><strong>Accidental:</strong> {{summary.isAccidental}}</p>
        <p><strong>Flood Damage:</strong> {{summary.floodDamage}}</p>
        <p><strong>Fire Damage:</strong> {{summary.fireDamage}}</p>
        <p><strong>Highlights:</strong> {{summary.highlights}}</p>
      </div>

      <!-- Sections: expects sections to be an array of {title, items: [{label, value}]} -->
      {{#sections}}
      <section class="inspection-section">
        <h3>{{title}}</h3>
        <ul class="items">
          {{#items}}
            <li class="item">
              <div class="label">{{label}}</div>
              <div class="value">{{value}}</div>
            </li>
          {{/items}}
        </ul>
      </section>
      {{/sections}}

      <!-- Fallback if sections not present but simple key-values exist -->
      {{^sections}}
      <section class="inspection-section">
        <h3>Details</h3>
        <ul class="items">
          {{#vehicle}}
            <li class="item">
              <div class="label">Reg Number</div>
              <div class="value">{{vehicle.regNumber}}</div>
            </li>
          {{/vehicle}}
        </ul>
      </section>
      {{/sections}}

      <!-- Images gallery: expects images to be an array of {title, url} -->
      {{#images}}
      <section class="inspection-section">
        <h3>Images</h3>
        <div class="images-grid">
          {{#images}}
            <div class="img-wrap">
              <img src="{{url}}" alt="{{title}}">
            </div>
          {{/images}}
        </div>
      </section>
      {{/images}}

      <!-- Documents (list) -->
      {{#documents}}
      <section class="inspection-section">
        <h3>Documents</h3>
        <ul>
          {{#documents}}
            <li>{{name}} — <small>{{note}}</small></li>
          {{/documents}}
        </ul>
      </section>
      {{/documents}}

    </main>

    <footer>
      <div>Generated by InspectionWale</div>
      <div>Report ID: {{inspectionId}} • Generated at {{generatedAt}}</div>
    </footer>
  </div>
</body>
</html>

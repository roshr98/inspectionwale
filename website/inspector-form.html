<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Professional Vehicle Inspection - InspectionWale</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <link href="Images/logo.png" rel="icon">
    
    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Icon Font -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0b556b 0%, #0073bb 100%);
            min-height: 100vh;
            padding: 20px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        body.authenticated {
            opacity: 1;
        }
        
        .header-bar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px 30px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .brand-logo {
            font-family: 'Poppins', sans-serif;
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, #0b556b 0%, #0073bb 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .btn-logout {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .btn-logout:hover {
            transform: scale(1.05);
        }
        
        .form-wrapper {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 25px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        
        .form-hero {
            background: linear-gradient(135deg, #0b556b 0%, #0073bb 100%);
            padding: 50px;
            text-align: center;
            color: white;
            position: relative;
            overflow: hidden;
        }
        
        .form-hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="50" r="40" fill="rgba(255,255,255,0.05)"/></svg>');
            opacity: 0.1;
        }
        
        .form-hero h1 {
            font-family: 'Poppins', sans-serif;
            font-size: 42px;
            font-weight: 800;
            margin-bottom: 15px;
            position: relative;
        }
        
        .form-hero p {
            font-size: 18px;
            opacity: 0.95;
            position: relative;
        }
        
        .form-content {
            padding: 50px;
        }
        
        .section {
            margin-bottom: 40px;
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .section-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid #0073bb;
        }
        
        .section-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #0b556b 0%, #0073bb 100%);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
        }
        
        .section-title {
            font-family: 'Poppins', sans-serif;
            font-size: 24px;
            font-weight: 700;
            color: #2d3748;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-label {
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .form-label .required {
            color: #e53e3e;
            margin-left: 4px;
        }
        
        .form-input, .form-select, .form-textarea {
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 15px;
            transition: all 0.3s;
            font-family: 'Inter', sans-serif;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #0073bb;
            box-shadow: 0 0 0 3px rgba(0, 115, 187, 0.1);
        }
        
        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        /* Photo Upload Styles */
        .photo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }
        
        .photo-item {
            border: 2px dashed #cbd5e0;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s;
            background: #f7fafc;
        }
        
        .photo-item:hover {
            border-color: #0073bb;
            background: #edf7ff;
        }
        
        .photo-item label {
            display: block;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 10px;
            font-size: 13px;
        }
        
        .photo-item input[type="file"] {
            display: block;
            width: 100%;
            padding: 8px;
            font-size: 12px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            background: white;
            cursor: pointer;
        }
        
        .photo-item .preview {
            margin-top: 10px;
            min-height: 120px;
            border-radius: 8px;
            overflow: hidden;
            background: #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .photo-item .preview img {
            max-width: 100%;
            max-height: 150px;
            object-fit: cover;
            border-radius: 8px;
        }
        
        .photo-item .preview.empty::before {
            content: '📷';
            font-size: 48px;
            opacity: 0.3;
        }
        
        .rating-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .rating-option {
            flex: 1;
            min-width: 120px;
        }
        
        .rating-option input[type="radio"] {
            display: none;
        }
        
        .rating-label {
            display: block;
            padding: 15px;
            text-align: center;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        .rating-option input[type="radio"]:checked + .rating-label {
            background: linear-gradient(135deg, #0b556b 0%, #0073bb 100%);
            color: white;
            border-color: #0073bb;
        }
        
        .submit-section {
            margin-top: 50px;
            padding: 40px;
            background: linear-gradient(135deg, #f6f8fb 0%, #e9ecef 100%);
            border-radius: 20px;
            text-align: center;
        }
        
        .btn-submit {
            background: linear-gradient(135deg, #0b556b 0%, #0073bb 100%);
            color: white;
            border: none;
            padding: 18px 60px;
            border-radius: 50px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 10px 30px rgba(0, 115, 187, 0.3);
        }
        
        .btn-submit:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(0, 115, 187, 0.4);
        }
        
        .btn-submit:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .status-message {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            font-weight: 600;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .info-box {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 5px solid #f39c12;
        }
        
        .info-box i {
            margin-right: 10px;
            color: #e67e22;
        }
        
        .photo-section-title {
            font-size: 16px;
            font-weight: 700;
            color: #0073bb;
            margin: 25px 0 15px 0;
            padding: 10px;
            background: #edf7ff;
            border-radius: 8px;
            border-left: 4px solid #0073bb;
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="brand-logo">
            <i class="fas fa-clipboard-check"></i> InspectionWale
        </div>
        <div class="user-info">
            <span id="inspectorName" style="font-weight: 600; color: #4a5568;"></span>
            <button class="btn-logout" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </div>
    </div>

    <div class="form-wrapper">
        <div class="form-hero">
            <h1><i class="fas fa-car"></i> Professional Vehicle Inspection Report</h1>
            <p>Complete detailed inspection form with photographs for comprehensive PDF reports</p>
        </div>

        <div class="form-content">
            <div class="info-box">
                <i class="fas fa-info-circle"></i>
                <strong>Important:</strong> All photo uploads are mandatory. Please capture clear, well-lit images for each section. Photos will be embedded in the final PDF report.
            </div>

            <form id="inspectionForm" enctype="multipart/form-data">
                <!-- VEHICLE REGISTRATION DETAILS -->
                <div class="section">
                    <div class="section-header">
                        <div class="section-icon"><i class="fas fa-car"></i></div>
                        <div class="section-title">Vehicle Registration Details</div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Registration Number <span class="required">*</span></label>
                            <input type="text" class="form-input" name="registrationNumber" required placeholder="e.g., MH04KD2255">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Make / Brand <span class="required">*</span></label>
                            <input type="text" class="form-input" name="make" required placeholder="e.g., Toyota, Honda">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Model <span class="required">*</span></label>
                            <input type="text" class="form-input" name="model" required placeholder="e.g., Fortuner, City">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Variant</label>
                            <input type="text" class="form-input" name="variant" placeholder="e.g., VX 4x4, ZX CVT">
                        </div>
                        <div class="form-group">
                            <label class="form-label">VIN / Chassis Number</label>
                            <input type="text" class="form-input" name="vinNumber" placeholder="17-character VIN">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Engine Number</label>
                            <input type="text" class="form-input" name="engineNumber" placeholder="Engine serial number">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Year of Manufacture <span class="required">*</span></label>
                            <input type="number" class="form-input" name="manufactureYear" required min="1990" max="2025" placeholder="2020">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Registration Date</label>
                            <input type="date" class="form-input" name="registrationDate">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Color <span class="required">*</span></label>
                            <input type="text" class="form-input" name="color" required placeholder="e.g., Pearl White">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Fuel Type <span class="required">*</span></label>
                            <select class="form-select" name="fuelType" required>
                                <option value="">Select Fuel Type</option>
                                <option value="Petrol">Petrol</option>
                                <option value="Diesel">Diesel</option>
                                <option value="CNG">CNG</option>
                                <option value="Electric">Electric</option>
                                <option value="Hybrid">Hybrid</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Odometer Reading (km) <span class="required">*</span></label>
                            <input type="number" class="form-input" name="odometerReading" required placeholder="45000">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Number of Owners</label>
                            <select class="form-select" name="ownersCount">
                                <option value="1">1st Owner</option>
                                <option value="2">2nd Owner</option>
                                <option value="3">3rd Owner</option>
                                <option value="4+">4+ Owners</option>
                            </select>
                        </div>
                    </div>

                    <!-- VEHICLE DOCUMENT PHOTOS -->
                    <div class="photo-section-title">
                        <i class="fas fa-file-alt"></i> Vehicle Documents & Identification
                    </div>
                    <div class="photo-grid">
                        <div class="photo-item">
                            <label>RC Book (Registration Certificate) <span class="required">*</span></label>
                            <input type="file" name="photo_rcBook" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_rcBook')">
                            <div class="preview empty" id="preview_rcBook"></div>
                        </div>
                        <div class="photo-item">
                            <label>Chassis Number Plate <span class="required">*</span></label>
                            <input type="file" name="photo_chassisPlate" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_chassisPlate')">
                            <div class="preview empty" id="preview_chassisPlate"></div>
                        </div>
                        <div class="photo-item">
                            <label>Odometer Reading <span class="required">*</span></label>
                            <input type="file" name="photo_odometer" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_odometer')">
                            <div class="preview empty" id="preview_odometer"></div>
                        </div>
                    </div>
                </div>

                <!-- OWNER DETAILS -->
                <div class="section">
                    <div class="section-header">
                        <div class="section-icon"><i class="fas fa-user"></i></div>
                        <div class="section-title">Current Owner Details</div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Owner Name <span class="required">*</span></label>
                            <input type="text" class="form-input" name="ownerName" required placeholder="Full Name">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Contact Number <span class="required">*</span></label>
                            <input type="tel" class="form-input" name="ownerContact" required placeholder="10-digit mobile">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email Address</label>
                            <input type="email" class="form-input" name="ownerEmail" placeholder="owner@example.com">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Inspection Location <span class="required">*</span></label>
                            <input type="text" class="form-input" name="location" required placeholder="City, State">
                        </div>
                    </div>
                </div>

                <!-- KEY HIGHLIGHTS -->
                <div class="section">
                    <div class="section-header">
                        <div class="section-icon"><i class="fas fa-star"></i></div>
                        <div class="section-title">Key Highlights & Summary</div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Accidental Status <span class="required">*</span></label>
                            <div class="rating-group">
                                <div class="rating-option">
                                    <input type="radio" id="accNo" name="accidental" value="No" checked>
                                    <label for="accNo" class="rating-label">✓ No Accident</label>
                                </div>
                                <div class="rating-option">
                                    <input type="radio" id="accMinor" name="accidental" value="Minor">
                                    <label for="accMinor" class="rating-label">⚠ Minor</label>
                                </div>
                                <div class="rating-option">
                                    <input type="radio" id="accMajor" name="accidental" value="Major">
                                    <label for="accMajor" class="rating-label">✗ Major</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Flood Damage <span class="required">*</span></label>
                            <div class="rating-group">
                                <div class="rating-option">
                                    <input type="radio" id="floodNo" name="floodDamage" value="No" checked>
                                    <label for="floodNo" class="rating-label">✓ No</label>
                                </div>
                                <div class="rating-option">
                                    <input type="radio" id="floodYes" name="floodDamage" value="Yes">
                                    <label for="floodYes" class="rating-label">✗ Yes</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Fire Damage <span class="required">*</span></label>
                            <div class="rating-group">
                                <div class="rating-option">
                                    <input type="radio" id="fireNo" name="fireDamage" value="No" checked>
                                    <label for="fireNo" class="rating-label">✓ No</label>
                                </div>
                                <div class="rating-option">
                                    <input type="radio" id="fireYes" name="fireDamage" value="Yes">
                                    <label for="fireYes" class="rating-label">✗ Yes</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group" style="margin-top: 20px;">
                        <label class="form-label">Top Comments / Key Highlights</label>
                        <textarea class="form-textarea" name="highlights" placeholder="Summarize key findings, noteworthy observations, or important points..."></textarea>
                    </div>
                </div>

                <!-- EXTERIOR / BODY INSPECTION -->
                <div class="section">
                    <div class="section-header">
                        <div class="section-icon"><i class="fas fa-paint-brush"></i></div>
                        <div class="section-title">Exterior / Body Inspection</div>
                    </div>

                    <div class="photo-section-title">
                        <i class="fas fa-camera"></i> Front Exterior Photos
                    </div>
                    <div class="photo-grid">
                        <div class="photo-item">
                            <label>Front Bumper <span class="required">*</span></label>
                            <input type="file" name="photo_frontBumper" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_frontBumper')">
                            <div class="preview empty" id="preview_frontBumper"></div>
                        </div>
                        <div class="photo-item">
                            <label>Bonnet <span class="required">*</span></label>
                            <input type="file" name="photo_bonnet" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_bonnet')">
                            <div class="preview empty" id="preview_bonnet"></div>
                        </div>
                        <div class="photo-item">
                            <label>Front Grille <span class="required">*</span></label>
                            <input type="file" name="photo_frontGrille" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_frontGrille')">
                            <div class="preview empty" id="preview_frontGrille"></div>
                        </div>
                        <div class="photo-item">
                            <label>Headlights (Both) <span class="required">*</span></label>
                            <input type="file" name="photo_headlights" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_headlights')">
                            <div class="preview empty" id="preview_headlights"></div>
                        </div>
                        <div class="photo-item">
                            <label>Windshield <span class="required">*</span></label>
                            <input type="file" name="photo_windshield" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_windshield')">
                            <div class="preview empty" id="preview_windshield"></div>
                        </div>
                        <div class="photo-item">
                            <label>Wipers <span class="required">*</span></label>
                            <input type="file" name="photo_wipers" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_wipers')">
                            <div class="preview empty" id="preview_wipers"></div>
                        </div>
                    </div>

                    <div class="photo-section-title">
                        <i class="fas fa-camera"></i> Side & Door Photos
                    </div>
                    <div class="photo-grid">
                        <div class="photo-item">
                            <label>Driver Side Door <span class="required">*</span></label>
                            <input type="file" name="photo_doorDriverFront" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_doorDriverFront')">
                            <div class="preview empty" id="preview_doorDriverFront"></div>
                        </div>
                        <div class="photo-item">
                            <label>Driver Side Rear Door <span class="required">*</span></label>
                            <input type="file" name="photo_doorDriverRear" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_doorDriverRear')">
                            <div class="preview empty" id="preview_doorDriverRear"></div>
                        </div>
                        <div class="photo-item">
                            <label>Passenger Side Front Door <span class="required">*</span></label>
                            <input type="file" name="photo_doorPassengerFront" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_doorPassengerFront')">
                            <div class="preview empty" id="preview_doorPassengerFront"></div>
                        </div>
                        <div class="photo-item">
                            <label>Passenger Side Rear Door <span class="required">*</span></label>
                            <input type="file" name="photo_doorPassengerRear" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_doorPassengerRear')">
                            <div class="preview empty" id="preview_doorPassengerRear"></div>
                        </div>
                        <div class="photo-item">
                            <label>Left Side Mirror <span class="required">*</span></label>
                            <input type="file" name="photo_mirrorLeft" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_mirrorLeft')">
                            <div class="preview empty" id="preview_mirrorLeft"></div>
                        </div>
                        <div class="photo-item">
                            <label>Right Side Mirror <span class="required">*</span></label>
                            <input type="file" name="photo_mirrorRight" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_mirrorRight')">
                            <div class="preview empty" id="preview_mirrorRight"></div>
                        </div>
                    </div>

                    <div class="photo-section-title">
                        <i class="fas fa-camera"></i> Rear Exterior Photos
                    </div>
                    <div class="photo-grid">
                        <div class="photo-item">
                            <label>Rear Bumper <span class="required">*</span></label>
                            <input type="file" name="photo_rearBumper" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_rearBumper')">
                            <div class="preview empty" id="preview_rearBumper"></div>
                        </div>
                        <div class="photo-item">
                            <label>Boot / Trunk (Closed) <span class="required">*</span></label>
                            <input type="file" name="photo_bootClosed" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_bootClosed')">
                            <div class="preview empty" id="preview_bootClosed"></div>
                        </div>
                        <div class="photo-item">
                            <label>Boot / Trunk (Open) <span class="required">*</span></label>
                            <input type="file" name="photo_bootOpen" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_bootOpen')">
                            <div class="preview empty" id="preview_bootOpen"></div>
                        </div>
                        <div class="photo-item">
                            <label>Taillights <span class="required">*</span></label>
                            <input type="file" name="photo_taillights" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_taillights')">
                            <div class="preview empty" id="preview_taillights"></div>
                        </div>
                        <div class="photo-item">
                            <label>Rear Windshield <span class="required">*</span></label>
                            <input type="file" name="photo_rearWindshield" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_rearWindshield')">
                            <div class="preview empty" id="preview_rearWindshield"></div>
                        </div>
                        <div class="photo-item">
                            <label>Roof <span class="required">*</span></label>
                            <input type="file" name="photo_roof" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_roof')">
                            <div class="preview empty" id="preview_roof"></div>
                        </div>
                    </div>

                    <div class="form-group" style="margin-top: 30px;">
                        <label class="form-label">Paint Condition & Notes</label>
                        <textarea class="form-textarea" name="paintNotes" placeholder="Describe paint condition, any scratches, dents, rust, or repainted panels..."></textarea>
                    </div>
                </div>

                <!-- INTERIOR INSPECTION -->
                <div class="section">
                    <div class="section-header">
                        <div class="section-icon"><i class="fas fa-couch"></i></div>
                        <div class="section-title">Interior Inspection</div>
                    </div>

                    <div class="photo-section-title">
                        <i class="fas fa-camera"></i> Interior Photos
                    </div>
                    <div class="photo-grid">
                        <div class="photo-item">
                            <label>Dashboard (Full View) <span class="required">*</span></label>
                            <input type="file" name="photo_dashboard" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_dashboard')">
                            <div class="preview empty" id="preview_dashboard"></div>
                        </div>
                        <div class="photo-item">
                            <label>Instrument Cluster <span class="required">*</span></label>
                            <input type="file" name="photo_instrumentCluster" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_instrumentCluster')">
                            <div class="preview empty" id="preview_instrumentCluster"></div>
                        </div>
                        <div class="photo-item">
                            <label>Steering Wheel <span class="required">*</span></label>
                            <input type="file" name="photo_steeringWheel" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_steeringWheel')">
                            <div class="preview empty" id="preview_steeringWheel"></div>
                        </div>
                        <div class="photo-item">
                            <label>Front Seats <span class="required">*</span></label>
                            <input type="file" name="photo_frontSeats" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_frontSeats')">
                            <div class="preview empty" id="preview_frontSeats"></div>
                        </div>
                        <div class="photo-item">
                            <label>Rear Seats <span class="required">*</span></label>
                            <input type="file" name="photo_rearSeats" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_rearSeats')">
                            <div class="preview empty" id="preview_rearSeats"></div>
                        </div>
                        <div class="photo-item">
                            <label>AC Control Panel <span class="required">*</span></label>
                            <input type="file" name="photo_acPanel" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_acPanel')">
                            <div class="preview empty" id="preview_acPanel"></div>
                        </div>
                        <div class="photo-item">
                            <label>Music System / Infotainment <span class="required">*</span></label>
                            <input type="file" name="photo_musicSystem" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_musicSystem')">
                            <div class="preview empty" id="preview_musicSystem"></div>
                        </div>
                        <div class="photo-item">
                            <label>Gear Lever <span class="required">*</span></label>
                            <input type="file" name="photo_gearLever" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_gearLever')">
                            <div class="preview empty" id="preview_gearLever"></div>
                        </div>
                        <div class="photo-item">
                            <label>Interior Roof / Ceiling <span class="required">*</span></label>
                            <input type="file" name="photo_interiorRoof" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_interiorRoof')">
                            <div class="preview empty" id="preview_interiorRoof"></div>
                        </div>
                    </div>

                    <div class="form-group" style="margin-top: 30px;">
                        <label class="form-label">Interior Condition Notes</label>
                        <textarea class="form-textarea" name="interiorNotes" placeholder="Describe interior condition, cleanliness, wear & tear, odors, functionality of controls..."></textarea>
                    </div>
                </div>

                <!-- ENGINE & MECHANICAL -->
                <div class="section">
                    <div class="section-header">
                        <div class="section-icon"><i class="fas fa-cog"></i></div>
                        <div class="section-title">Engine & Mechanical Inspection</div>
                    </div>

                    <div class="photo-section-title">
                        <i class="fas fa-camera"></i> Engine Bay Photos
                    </div>
                    <div class="photo-grid">
                        <div class="photo-item">
                            <label>Engine Bay (Overall) <span class="required">*</span></label>
                            <input type="file" name="photo_engineBay" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_engineBay')">
                            <div class="preview empty" id="preview_engineBay"></div>
                        </div>
                        <div class="photo-item">
                            <label>Engine Block <span class="required">*</span></label>
                            <input type="file" name="photo_engineBlock" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_engineBlock')">
                            <div class="preview empty" id="preview_engineBlock"></div>
                        </div>
                        <div class="photo-item">
                            <label>Battery <span class="required">*</span></label>
                            <input type="file" name="photo_battery" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_battery')">
                            <div class="preview empty" id="preview_battery"></div>
                        </div>
                        <div class="photo-item">
                            <label>Radiator <span class="required">*</span></label>
                            <input type="file" name="photo_radiator" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_radiator')">
                            <div class="preview empty" id="preview_radiator"></div>
                        </div>
                        <div class="photo-item">
                            <label>Oil Cap / Dipstick <span class="required">*</span></label>
                            <input type="file" name="photo_oilCap" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_oilCap')">
                            <div class="preview empty" id="preview_oilCap"></div>
                        </div>
                        <div class="photo-item">
                            <label>Belts & Hoses <span class="required">*</span></label>
                            <input type="file" name="photo_beltsHoses" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_beltsHoses')">
                            <div class="preview empty" id="preview_beltsHoses"></div>
                        </div>
                    </div>

                    <div class="form-group" style="margin-top: 30px;">
                        <label class="form-label">Engine Condition & Mechanical Notes</label>
                        <textarea class="form-textarea" name="engineNotes" placeholder="Describe engine sound, oil leaks, coolant condition, battery health, any unusual noises..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Estimated Repair Cost (if applicable)</label>
                        <input type="text" class="form-input" name="repairCost" placeholder="₹ 0">
                    </div>
                </div>

                <!-- TIRES & WHEELS -->
                <div class="section">
                    <div class="section-header">
                        <div class="section-icon"><i class="fas fa-circle-notch"></i></div>
                        <div class="section-title">Tires & Wheels Inspection</div>
                    </div>

                    <div class="photo-section-title">
                        <i class="fas fa-camera"></i> Tire Photos (All 4 + Spare)
                    </div>
                    <div class="photo-grid">
                        <div class="photo-item">
                            <label>Front Left Tire <span class="required">*</span></label>
                            <input type="file" name="photo_tireFrontLeft" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_tireFrontLeft')">
                            <div class="preview empty" id="preview_tireFrontLeft"></div>
                        </div>
                        <div class="photo-item">
                            <label>Front Right Tire <span class="required">*</span></label>
                            <input type="file" name="photo_tireFrontRight" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_tireFrontRight')">
                            <div class="preview empty" id="preview_tireFrontRight"></div>
                        </div>
                        <div class="photo-item">
                            <label>Rear Left Tire <span class="required">*</span></label>
                            <input type="file" name="photo_tireRearLeft" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_tireRearLeft')">
                            <div class="preview empty" id="preview_tireRearLeft"></div>
                        </div>
                        <div class="photo-item">
                            <label>Rear Right Tire <span class="required">*</span></label>
                            <input type="file" name="photo_tireRearRight" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_tireRearRight')">
                            <div class="preview empty" id="preview_tireRearRight"></div>
                        </div>
                        <div class="photo-item">
                            <label>Spare Tire <span class="required">*</span></label>
                            <input type="file" name="photo_tireSpare" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_tireSpare')">
                            <div class="preview empty" id="preview_tireSpare"></div>
                        </div>
                        <div class="photo-item">
                            <label>Alloy Wheels (if applicable)</label>
                            <input type="file" name="photo_alloyWheels" accept="image/*" capture="environment" onchange="previewImage(this, 'preview_alloyWheels')">
                            <div class="preview empty" id="preview_alloyWheels"></div>
                        </div>
                    </div>

                    <div class="form-grid" style="margin-top: 30px;">
                        <div class="form-group">
                            <label class="form-label">Tire Brand & Condition</label>
                            <input type="text" class="form-input" name="tireBrand" placeholder="e.g., MRF, Michelin, Apollo">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Average Tread Depth Remaining</label>
                            <input type="text" class="form-input" name="treadDepth" placeholder="e.g., 60%, 4mm">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tires & Wheels Notes</label>
                        <textarea class="form-textarea" name="tiresNotes" placeholder="Describe tire condition, tread wear, alignment issues, wheel damage..."></textarea>
                    </div>
                </div>

                <!-- UNDERCARRIAGE & STRUCTURE -->
                <div class="section">
                    <div class="section-header">
                        <div class="section-icon"><i class="fas fa-layer-group"></i></div>
                        <div class="section-title">Undercarriage & Structure</div>
                    </div>

                    <div class="photo-section-title">
                        <i class="fas fa-camera"></i> Undercarriage Photos
                    </div>
                    <div class="photo-grid">
                        <div class="photo-item">
                            <label>Front Undercarriage <span class="required">*</span></label>
                            <input type="file" name="photo_undercarriageFront" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_undercarriageFront')">
                            <div class="preview empty" id="preview_undercarriageFront"></div>
                        </div>
                        <div class="photo-item">
                            <label>Rear Undercarriage <span class="required">*</span></label>
                            <input type="file" name="photo_undercarriageRear" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_undercarriageRear')">
                            <div class="preview empty" id="preview_undercarriageRear"></div>
                        </div>
                        <div class="photo-item">
                            <label>Exhaust System <span class="required">*</span></label>
                            <input type="file" name="photo_exhaust" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_exhaust')">
                            <div class="preview empty" id="preview_exhaust"></div>
                        </div>
                        <div class="photo-item">
                            <label>Suspension (Front) <span class="required">*</span></label>
                            <input type="file" name="photo_suspensionFront" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_suspensionFront')">
                            <div class="preview empty" id="preview_suspensionFront"></div>
                        </div>
                        <div class="photo-item">
                            <label>Suspension (Rear) <span class="required">*</span></label>
                            <input type="file" name="photo_suspensionRear" accept="image/*" capture="environment" required onchange="previewImage(this, 'preview_suspensionRear')">
                            <div class="preview empty" id="preview_suspensionRear"></div>
                        </div>
                        <div class="photo-item">
                            <label>Chassis / Frame</label>
                            <input type="file" name="photo_chassis" accept="image/*" capture="environment" onchange="previewImage(this, 'preview_chassis')">
                            <div class="preview empty" id="preview_chassis"></div>
                        </div>
                    </div>

                    <div class="form-group" style="margin-top: 30px;">
                        <label class="form-label">Undercarriage & Structure Notes</label>
                        <textarea class="form-textarea" name="structureNotes" placeholder="Describe rust, damage, leaks, suspension condition, frame integrity..."></textarea>
                    </div>
                </div>

                <!-- TEST DRIVE & OVERALL ASSESSMENT -->
                <div class="section">
                    <div class="section-header">
                        <div class="section-icon"><i class="fas fa-road"></i></div>
                        <div class="section-title">Test Drive & Overall Assessment</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Test Drive Conducted? <span class="required">*</span></label>
                        <div class="rating-group">
                            <div class="rating-option">
                                <input type="radio" id="testYes" name="testDrive" value="Yes" checked>
                                <label for="testYes" class="rating-label">✓ Yes</label>
                            </div>
                            <div class="rating-option">
                                <input type="radio" id="testNo" name="testDrive" value="No">
                                <label for="testNo" class="rating-label">✗ No</label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Test Drive Observations</label>
                        <textarea class="form-textarea" name="testDriveNotes" placeholder="Engine performance, gear shifting, brakes response, handling, noise levels, vibrations, AC performance..."></textarea>
                    </div>

                    <div class="form-group" style="margin-top: 30px;">
                        <label class="form-label">Overall Condition Rating <span class="required">*</span></label>
                        <div class="rating-group">
                            <div class="rating-option">
                                <input type="radio" id="excellent" name="overallRating" value="Excellent">
                                <label for="excellent" class="rating-label">⭐⭐⭐⭐⭐ Excellent</label>
                            </div>
                            <div class="rating-option">
                                <input type="radio" id="good" name="overallRating" value="Good" checked>
                                <label for="good" class="rating-label">⭐⭐⭐⭐ Good</label>
                            </div>
                            <div class="rating-option">
                                <input type="radio" id="average" name="overallRating" value="Average">
                                <label for="average" class="rating-label">⭐⭐⭐ Average</label>
                            </div>
                            <div class="rating-option">
                                <input type="radio" id="poor" name="overallRating" value="Poor">
                                <label for="poor" class="rating-label">⭐⭐ Poor</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Major Issues Found</label>
                        <textarea class="form-textarea" name="issuesFound" placeholder="List any major issues, defects, or concerns discovered during inspection..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Recommendations</label>
                        <textarea class="form-textarea" name="recommendations" placeholder="Suggest repairs, maintenance, or actions required. Provide buying advice if applicable..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Market Value Estimate</label>
                        <input type="text" class="form-input" name="marketValue" placeholder="₹ Estimated market value">
                    </div>
                </div>

                <!-- SUBMIT SECTION -->
                <div class="submit-section">
                    <h3 style="margin-bottom: 20px; color: #2d3748;">Ready to Generate Report?</h3>
                    <p style="margin-bottom: 30px; color: #4a5568;">Please review all information and ensure all required photos are uploaded before submitting.</p>
                    <button type="submit" class="btn-submit" id="submitBtn">
                        <i class="fas fa-file-pdf"></i> Generate Inspection Report with Photos
                    </button>
                    <div id="statusMessage"></div>
                    <div id="uploadProgress" style="margin-top: 20px; display: none;">
                        <div style="background: #e2e8f0; height: 30px; border-radius: 15px; overflow: hidden;">
                            <div id="progressBar" style="background: linear-gradient(90deg, #0b556b, #0073bb); height: 100%; width: 0%; transition: width 0.3s; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 14px;"></div>
                        </div>
                        <p id="progressText" style="margin-top: 10px; text-align: center; color: #4a5568;"></p>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Check authentication before page loads
        (function() {
            const token = sessionStorage.getItem('inspectorToken');
            if (!token) {
                window.location.replace('inspector-login.html');
                return;
            }
        })();

        // Load inspector name from sessionStorage
        document.addEventListener('DOMContentLoaded', () => {
            const token = sessionStorage.getItem('inspectorToken');
            const inspectorName = sessionStorage.getItem('inspectorName');
            
            if (!token) {
                window.location.replace('inspector-login.html');
                return;
            }
            
            // Show page content
            document.body.classList.add('authenticated');
            
            if (inspectorName) {
                document.getElementById('inspectorName').textContent = `Inspector: ${inspectorName}`;
            }
        });

        function logout() {
            sessionStorage.clear();
            window.location.href = 'inspector-login.html';
        }

        // Compress image to reduce file size
        async function compressImage(file, maxSizeMB = 0.5) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        let width = img.width;
                        let height = img.height;
                        
                        // Resize if too large
                        const maxDimension = 1920;
                        if (width > maxDimension || height > maxDimension) {
                            if (width > height) {
                                height = (height / width) * maxDimension;
                                width = maxDimension;
                            } else {
                                width = (width / height) * maxDimension;
                                height = maxDimension;
                            }
                        }
                        
                        canvas.width = width;
                        canvas.height = height;
                        
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        // Start with quality 0.8, reduce if still too large
                        let quality = 0.8;
                        canvas.toBlob((blob) => {
                            // If still larger than maxSizeMB, reduce quality further
                            if (blob.size > maxSizeMB * 1024 * 1024) {
                                quality = 0.6;
                                canvas.toBlob((finalBlob) => {
                                    resolve(new File([finalBlob], file.name, {
                                        type: 'image/jpeg',
                                        lastModified: Date.now()
                                    }));
                                }, 'image/jpeg', quality);
                            } else {
                                resolve(new File([blob], file.name, {
                                    type: 'image/jpeg',
                                    lastModified: Date.now()
                                }));
                            }
                        }, 'image/jpeg', quality);
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            });
        }

        // Preview image function with compression
        async function previewImage(input, previewId) {
            const preview = document.getElementById(previewId);
            const file = input.files[0];
            
            if (file) {
                // Show original size
                const originalSizeMB = (file.size / (1024 * 1024)).toFixed(2);
                
                // Compress if larger than 1MB
                let processedFile = file;
                if (file.size > 1024 * 1024) {
                    preview.innerHTML = '<div style="padding: 10px; color: #0b556b;">Compressing image...</div>';
                    processedFile = await compressImage(file);
                    const compressedSizeMB = (processedFile.size / (1024 * 1024)).toFixed(2);
                    console.log(`Compressed ${file.name}: ${originalSizeMB}MB → ${compressedSizeMB}MB`);
                    
                    // Replace the file input with compressed file
                    const dataTransfer = new DataTransfer();
                    dataTransfer.items.add(processedFile);
                    input.files = dataTransfer.files;
                }
                
                // Show preview
                const reader = new FileReader();
                reader.onload = function(e) {
                    const compressedSizeMB = (processedFile.size / (1024 * 1024)).toFixed(2);
                    preview.innerHTML = `
                        <img src="${e.target.result}" alt="Preview">
                        <div style="font-size: 10px; color: #666; margin-top: 5px;">${compressedSizeMB}MB</div>
                    `;
                    preview.classList.remove('empty');
                };
                reader.readAsDataURL(processedFile);
            }
        }

        // Handle form submission with file uploads
        document.getElementById('inspectionForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const statusDiv = document.getElementById('statusMessage');
            const uploadProgress = document.getElementById('uploadProgress');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Uploading Photos & Generating Report...';
            uploadProgress.style.display = 'block';
            
            const formData = new FormData(e.target);
            
            // Add token and inspector name
            formData.append('token', sessionStorage.getItem('inspectorToken'));
            formData.append('inspectorName', sessionStorage.getItem('inspectorName'));
            
            try {
                progressBar.style.width = '10%';
                progressBar.textContent = '10%';
                progressText.textContent = 'Uploading photos...';
                
                const response = await fetch('https://mfy5ajp4e5lggmqypfbco34dd40ugreq.lambda-url.us-east-1.on.aws/', {
                    method: 'POST',
                    body: formData
                });
                
                progressBar.style.width = '70%';
                progressBar.textContent = '70%';
                progressText.textContent = 'Generating PDF report...';
                
                const result = await response.json();
                
                if (response.ok && result.reportUrl) {
                    progressBar.style.width = '100%';
                    progressBar.textContent = '100%';
                    progressText.textContent = 'Complete!';
                    
                    statusDiv.className = 'status-message status-success';
                    statusDiv.innerHTML = `
                        <i class="fas fa-check-circle"></i> Report with photos generated successfully!<br>
                        <a href="${result.reportUrl}" target="_blank" style="color: #155724; text-decoration: underline; font-weight: bold; margin-top: 10px; display: inline-block;">
                            <i class="fas fa-download"></i> Download PDF Report
                        </a>
                    `;
                    
                    // Reset form after delay
                    setTimeout(() => {
                        if (confirm('Report generated successfully! Would you like to start a new inspection?')) {
                            e.target.reset();
                            statusDiv.innerHTML = '';
                            uploadProgress.style.display = 'none';
                            
                            // Clear all preview images
                            document.querySelectorAll('.preview').forEach(preview => {
                                preview.innerHTML = '';
                                preview.classList.add('empty');
                            });
                        }
                    }, 2000);
                } else {
                    throw new Error(result.message || 'Failed to generate report');
                }
            } catch (error) {
                console.error('Submission error:', error);
                statusDiv.className = 'status-message status-error';
                statusDiv.innerHTML = `
                    <i class="fas fa-exclamation-circle"></i> Error: ${error.message}<br>
                    <small>Please check your photos and try again. Large files may take longer to upload.</small>
                `;
                uploadProgress.style.display = 'none';
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-file-pdf"></i> Generate Inspection Report with Photos';
            }
        });
    </script>
</body>
</html>
